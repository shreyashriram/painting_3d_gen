# Painting 3D Objects with Generative AI

**Generate custom textures from text prompts!**

<table style="padding:10px">
  <tr>
    <td height= "200px"><img src="assets/iron_man.gif"  alt="1" > </td>
    <td height= "200px"><img src="assets/brownCow.gif" alt="3" </td>
  </tr>
  
   <tr>
    <td><i>"Iron Man Inspired"</i></td>
   <td><i>"Brown Cow"</i></td>
  </tr>
</table>

This is an exploration into leveraging Generative AI models to craft 3D texture maps based on text prompts. These AI-generated textures can offer stylization and personalization, enabling swift coloring of 3D game assets. 

This project utilizes `PyTorch3D`, a 3D data library enabling advanced computer graphics tasks such as rendering and texture mapping. Additionally, it uses `OpenCV` and the `StableDiffusionControlNet` pipeline to generate stylized images of our mesh. These images are subsequently used to iteratively fit a **texture map** using an optimization loop.

This process is summarized in the figure below:
![alt text](assets/pipeline.png "process")

### Get Started

[Google Colab Notebook](https://colab.research.google.com/drive/1BUOxNyuMiDIokIS5tsBP6QS-iCpbmUX8?usp=sharing) 


### Approach
#### Target Image Generation using Multi-ControlNet

ControlNet conditioning is used for text-to-image generation, resulting in target images that will be reconstructed into a texture map in the next step. 

ControlNet, an extension of stable diffusion models, offers the ability to precisely control the generation area, incorporating spatial context. This approach uses Multi-ControlNet, stacking multiple conditionings like Canny edge and depth maps to enhance the produced images.

![alt text](assets/mControlNet.png "process")

#### "Texture Baking" with an Adam Optimizer 

The texture map is predicted by observing the target images generated by ControlNet. Starting with random noise, it learns the correct RGB colors such that a rendered image using the predicted mesh is iteratively more similar to the target image.

Optimization Loop:
1. Render the mesh with the predicted map from the same camera angle as the target image.
2. Compare the rendered image and target image to compute RGB loss. 
3. Backpropgate to update texture map based on loss. 

![alt text](assets/adamopt.png "process")

> The diagram above represents 2D optimization, using a single view to predict the texture map. The same approach applies for 3D optimization. Loss is calculated as a weighted average of the different view's RGB loss.

### Results
<table style="padding:10px">
  <tr>
    <td width="50%"  height= "200px" ><img src="assets/texture_map.png"  alt="1" > </td>
   <td width="50%" height= "200px" ><img src="assets/brownCow.gif" alt="3"></td>
  </tr>
  
   <tr>
    <td><i>Texture Map</i></td>
   <td><i>3D Render</i></td>
  </tr>
</table>

### Future Directions
**Texture Map Denoising** - 
The resultant texture map is still quite noisy, even in areas that are well represented in target images. Applying image processing techniques such as denoising or interpolation in post processing can refine the texture map significantly.

**Character Consistency with Stable Diffusion** - 
One source of doubt when learning colors from generated target images is when the images look different from various views. For instance, the back of an object might appear a different color in a side view compared to a top view. Introducing character consistency during image generation can help address this issue. Combining ControlNet with models like DreamBooth or LoRA has proven effective in generating different images with consistent character appearances.

## Acknowledgements
I had an opportunity to work on this project during my 8-week micro-internship at [Hypothetic](https://www.hypothetic.art/), facilitated by [OpenAvenues](https://www.openavenuesfoundation.org/micro-internships). Thank you to Pablo Weidemann, chief of product at Hypothetic, for his guidance and mentorship as my Project Leader!

This project provided me a great opportunity to blend my interests in computer graphics and machine learning. I look forward to continuing my exploration into this interdisciplinary field!

#### Tutorials and Further Reading
- [Pytorch3D - Render a Textured Mesh](https://pytorch3d.org/tutorials/render_textured_meshes)
- [Pytorch3D - Fit a Mesh with Texture via Rendering](https://pytorch3d.org/tutorials/fit_textured_mesh)
- [Ultra fast ControlNet with ðŸ§¨ Diffusers](https://huggingface.co/blog/controlnet)
- [TEXTure: Text-Guided Texturing of 3D Shapes](https://texturepaper.github.io/TEXTurePaper/)
- [Complete Guide to Adam Optimization](https://towardsdatascience.com/complete-guide-to-adam-optimization-1e5f29532c3d)